<!Doctype HTML>
<html>
	<head lang="us-en">

    	<meta charset="utf-8"> 

		<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

		<script src="questions.js"></script>

		<script>
	
			var score = 1000;

			var finalWager = 0;
			var timeoutId;

			var currentCategory;
			var currentValue;

			var finalQuestionNum = Math.floor(Math.random() * 4);
			var finalQuestion = finalQuestions[finalQuestionNum];

			var questionsLeft = 0;

			for (numCategories = 0; numCategories < questions.length; numCategories++) {
				for (numQuestions = 0; numQuestions < questions[numCategories].length; numQuestions++) {
					questionsLeft++;
				}
			}

			const totalQuestions = questionsLeft;

			function getCategoryTitle(categoryNum) {
				return questions[categoryNum][0];
			}

			function getQuestion(categoryNum, pointVal) {
				return questions[categoryNum][pointVal/100].question;
			}

			function getAnswerChoice(categoryNum, pointVal, answerNum) {
				return questions[categoryNum][pointVal/100].answers[answerNum];
			}

			function getCorrectAnswer(categoryNum, pointVal) {
				return questions[categoryNum][pointVal/100].correctAnswer;
			}

			function isAnsweCorrect(categoryNum, pointVal, selectedChoice) {
				var correct = false;
				if (selectedChoice = questions[categoryNum][(pointVal/100) - 1].correctAnswer) {
					correct = true;
				}
				return correct;
			}

			function getFinalQuestion() {
				return finalQuestion.question;
			} 

			function getFinalAnswerChoice(answerNum) {
				return finalQuestion.answers[answerNum];
			}

			function getFinalCorrectAnswer() {
				return finalQuestion.correctAnswer;
			}

			function isFinalAnsweCorrect(selectedChoice) {
				var correct = false;
				if (selectedChoice = finalQuestion.correctAnswer) {
					correct = true;
				}
				return correct;
			}

			function setHtmlDivText(text, divId) {
				document.getElementById(divId).innerHTML = text;
			}

			function hidePage(pageToBeHidden) {
				document.getElementById(pageToBeHidden).style.display='none'; 
			}

			function showPage(pageToBeShown) {
				document.getElementById(pageToBeShown).style.display='block';
			}

			function hideAndShow(pageToBeHidden, pageToBeShown) {
				hidePage(pageToBeHidden);
				showPage(pageToBeShown);

				if (pageToBeHidden == "questionPage") { //Resets the question page
					document.getElementById("answer0").className = "col-md-6 alert alert-info";
					document.getElementById("answer1").className = "col-md-6 alert alert-info";
					document.getElementById("answer2").className = "col-md-6 alert alert-info";
					document.getElementById("answer3").className = "col-md-6 alert alert-info";
				}

				if (pageToBeShown == "chooseQuestionPage") { //Sets the answered question as completed
					for (categoryIt = 0; categoryIt < questions.length; categoryIt++) {
						for (valueIt = 1; valueIt < questions[categoryIt].length; valueIt++) {
							if (questions[categoryIt][valueIt].taken) {
								var divId = "" + (categoryIt) + "." + (valueIt * 100);
								var element = document.getElementById(divId);
								element.innerHTML = "<p>" + (valueIt * 100) + "</p>";
								if (questions[categoryIt][valueIt].correct) {
									element.className = "alert alert-success";
								} else {
									element.className = "alert alert-danger";
								}
							}
						}
					}
				}

				//Chance of going to final question:
				var chanceForFinale = Math.floor((totalQuestions - 3) * Math.random());
				console.log("Will move on if semi-random number is greater than number of remaining questions.\nsemi-random number: " + chanceForFinale + "\nRemaining questions: " + questionsLeft);
				if (questionsLeft == 0) {
					showFinalQuestionPage();
				}
				else if (chanceForFinale >= questionsLeft) {
					if (confirm("Are you ready for the final question?")) {
						showFinalQuestionPage();
					}
				}
			}

			//This function is the one that starts the final question segment
			function showFinalQuestionPage() {
				var finalQuestionCategory = Math.floor(Math.random() * questions.length);
				var finalQuestionValue = Math.floor(Math.random() * (questions[finalQuestionCategory].length - 1));
				finalQuestionValue++; //This way it won't be the category name
				if (!questions[finalQuestionCategory][finalQuestionValue].taken) { //If the chosen question isn't taken, the final question can be that one. Otherwise, it's one of four special questions
					finalQuestion = questions[finalQuestionCategory][finalQuestionValue];
				}
				
				while (true) {
					if (score > 0) {
						finalWager = prompt("Final Question: How much would you like to wager?", "");
						finalWager = Number(finalWager);
						if (finalWager == NaN) {
							alert("That wasn't a number... \nTry again.");
						} else if (finalWager > score) {
							alert("You don't have that much money... \nTry again.")
						} else if (finalWager < 0) {
							alert("Uhh, that's negative... \nTry again.")
						} else {
							break;
						}
					} else if (score < 0) {
						finalWager = prompt("Final Question: You have negative money. You can bet up to the absolute value of your total.\nHow much would you like to wager?", "");
						finalWager = Number(finalWager);
						if (finalWager == NaN) {
							alert("That wasn't a number... \nTry again.");
						} else if (finalWager > -score) {
							alert("You don't have that much money... \nTry again.")
						} else if (finalWager < 0) {
							alert("Please input a positive number... \nTry again.")
						} else {
							break;
						}
					}
				}

				document.getElementById('questionPage').style.display='block';
				document.getElementById('chooseQuestionPage').style.display='none';

				setHtmlDivText("<b>Final question: </b>" + getFinalQuestion(), "question");
				setHtmlDivText("<a href='#' onclick='submitFinalQuestion(document.getElementById(\"answer0\"),0)'>" + getFinalAnswerChoice(0) + "</a>", "answer0");
				setHtmlDivText("<a href='#' onclick='submitFinalQuestion(document.getElementById(\"answer1\"),1)'>" + getFinalAnswerChoice(1) + "</a>", "answer1");
				setHtmlDivText("<a href='#' onclick='submitFinalQuestion(document.getElementById(\"answer2\"),2)'>" + getFinalAnswerChoice(2) + "</a>", "answer2");
				setHtmlDivText("<a href='#' onclick='submitFinalQuestion(document.getElementById(\"answer3\"),3)'>" + getFinalAnswerChoice(3) + "</a>", "answer3");
				setHtmlDivText("", "return");
			}

			function showQuestionPage(setCategory, setValue) {
				document.getElementById('questionPage').style.display='block';
				document.getElementById('chooseQuestionPage').style.display='none';
				currentCategory = setCategory;
				currentValue = setValue;
				setHtmlDivText(getQuestion(currentCategory, currentValue), "question");
				setHtmlDivText("<a href='#' onclick='submitQuestion(document.getElementById(\"answer0\"),0)'>" + getAnswerChoice(currentCategory, currentValue, 0) + "</a>", "answer0");
				setHtmlDivText("<a href='#' onclick='submitQuestion(document.getElementById(\"answer1\"),1)'>" + getAnswerChoice(currentCategory, currentValue, 1) + "</a>", "answer1");
				setHtmlDivText("<a href='#' onclick='submitQuestion(document.getElementById(\"answer2\"),2)'>" + getAnswerChoice(currentCategory, currentValue, 2) + "</a>", "answer2");
				setHtmlDivText("<a href='#' onclick='submitQuestion(document.getElementById(\"answer3\"),3)'>" + getAnswerChoice(currentCategory, currentValue, 3) + "</a>", "answer3");
				setHtmlDivText("", "return");
			}

			function submitQuestion(div, selectedChoice) {
				var correctAnswer = getCorrectAnswer(currentCategory, currentValue);
				questions[currentCategory][currentValue/100].taken = true;
				if (selectedChoice != correctAnswer) {
					div.className = "col-md-6 alert alert-danger";
					score -= (.5 * currentValue);
					questions[currentCategory][currentValue/100].correct = false;
					setHtmlDivText('<div class="alert alert-danger" role="alert">Incorrect! You lost ' + (.5 * currentValue) + ' points. Your new score is <b>' + score + '</b>.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>', 'alert');
					timeoutId = setTimeout(function() { setHtmlDivText('','alert'); }, 5000);
				} else {
					score += currentValue;
					questions[currentCategory][currentValue/100].correct = true;
					setHtmlDivText('<div class="alert alert-success" role="alert">Correct! You got ' + currentValue + ' points. Your new score is <b>' + score + '</b>.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>', 'alert');
					timeoutId = setTimeout(function() { setHtmlDivText('','alert'); }, 5000);
				}
				var correctDivId = "answer" + correctAnswer;
				document.getElementById(correctDivId).className = "col-md-6 alert alert-success";

				setHtmlDivText("<p>" + getAnswerChoice(currentCategory, currentValue, 0) + "</p>", "answer0");
				setHtmlDivText("<p>" + getAnswerChoice(currentCategory, currentValue, 1) + "</p>", "answer1");
				setHtmlDivText("<p>" + getAnswerChoice(currentCategory, currentValue, 2) + "</p>", "answer2");
				setHtmlDivText("<p>" + getAnswerChoice(currentCategory, currentValue, 3) + "</p>", "answer3");
				setHtmlDivText("<button type='button' class='btn btn-primary' onclick='hideAndShow(\"questionPage\", \"chooseQuestionPage\")'>Return</button>", "return");
				updateScore();

				questionsLeft--;
			}

			function submitFinalQuestion(div, selectedChoice) {
				var correctAnswer = getFinalCorrectAnswer();

				clearTimeout(timeoutId);
				setTimeout(function() { setHtmlDivText('','alert'); }, 7500);

				if (selectedChoice != correctAnswer) {
					div.className = "col-md-6 alert alert-danger";
					score -= finalWager;
					//questions[currentCategory][currentValue/100].correct = false;
					setHtmlDivText('<div class="alert alert-danger" role="alert">Incorrect! You lost ' + finalWager + ' points. Your final score is <b>' + score + '</b>.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>', 'alert');
					//setTimeout(function() { setHtmlDivText('','alert'); }, 5000);
				} else {
					score += finalWager;
					//questions[currentCategory][currentValue/100].correct = true;
					setHtmlDivText('<div class="alert alert-success" role="alert">Correct! You got ' + finalWager + ' points. Your final score is <b>' + score + '</b>.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>', 'alert');
					//setTimeout(function() { setHtmlDivText('','alert'); }, 5000);
				}
				var correctDivId = "answer" + correctAnswer;
				document.getElementById(correctDivId).className = "col-md-6 alert alert-success";

				updateScore();

				var body = document.getElementById("body");
				
				var imageName;
				var imageNum = Math.floor(Math.random() * 3);

				imageNum = 2;

				if (imageNum == 0) {
					imageName = "url('images/stones.jpg')";
				} else if (imageNum == 1) {
					imageName = "url('images/temple_ruins.jpg')";
				} else if (imageNum == 2) {
					imageName = "url('images/sea_ruins.jpg')";
				} 

				body.style.background = imageName;
				body.style.backgroundSize = "100%";

				hidePage("questionPage");

				setHtmlDivText('<div class="jumbotron fixed-bottom" style="position:fixed; bottom:0; width: 100%; background: rgba(244, 246, 236, 0.75);"><div class="container"><h1>Final score: ' + score + '</h1><h3>Thanks for playing!</h3><p><a class="btn btn-primary btn-lg" href="index.html" role="button">Home</a></p></div></div>','finalResult');
			}

			function updateScore() {
				document.getElementById('score').innerHTML = 'Current score: ' + score;
			}
		</script>
	</head>

	<body id="body" style="background-color:rgb(251, 254, 256)">
		<nav class="navbar navbar-fixed-top navbar-inverse">
		    <div class="container-fluid">
		        <!-- Brand and toggle get grouped for better mobile display -->
		        <div class="navbar-header">
		            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
		                <span class="sr-only">Toggle navigation</span>
		                <span class="icon-bar"></span>
		                <span class="icon-bar"></span>
		                <span class="icon-bar"></span>
		            </button>
		            <a href="index.html"><img src="images/Prism_Logo.png" style="height:50px;padding:4px" alt="Prism"></a>
		            <!--<a class="navbar-brand" href="#">Brand</a>-->
		        </div>

		        <!-- Collect the nav links, forms, and other content for toggling -->
		        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		            <ul class="nav navbar-nav">
		            	<!--<li>&nbsp &nbsp</li>-->
		                <li class="active"><a href="game.html">Play</a></li>
		                <li><a href="#" data-toggle="modal" data-target="#About">About</a></li>
		                <li><a href="#" data-toggle="modal" data-target="#HowToPlay">How to play</a></li>
		            </ul>
		        </div><!-- /.navbar-collapse -->
		    </div><!-- /.container-fluid -->
		</nav>
		<br><br>
		<div class="modal fade" id="About" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
		    	<div class="modal-content">
		      		<div class="modal-header">
		        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        		<h4 class="modal-title" id="myModalLabel">Instructions</h4>
		      		</div>
		      		<div class="modal-body">
		        		<img src="images/Prism_Logo.png" alt="Prism Logo" width="250">
		        		<br>
		        		<p>Prism is a game made by Jake Sanders, Karen Jiang, Arul Kapoor, and William Hah for Computer Science II at the Horace Mann School. It was made for Ms. Bahr for use in reviewing material such as <i>The Odyssey</i>. It is built in HTML and JavaScript, using bootstrap.</p>
		        		<br><br>
		        		<p>Made in May 2016.</p>
		      		</div>
		      		<div class="modal-footer">
		        		<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
		      		</div>
		    	</div>
		  	</div>
		</div>
		<div class="modal fade" id="HowToPlay" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
		    	<div class="modal-content">
		      		<div class="modal-header">
		        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        		<h4 class="modal-title" id="myModalLabel">Instructions</h4>
		      		</div>
		      		<div class="modal-body">
		        		<p>To play, simply press on a blue value to get to a question. Four choices will be shown. Select the best one, and you will either gain points equal to the value if you're right, or lose half that many points. Then continue, in all different categories with all different questions! It's as easy as that!</p>
						<br><br><br>
		        		<p>The further you go through the game, the more likely you will be prompted to go to the final question. After answering all of the questions, you will automatically proceed to it, and you can always choose to by pressing the button at the bottom of the select-questions page. There, you can bet any amount of money up to your total. If you win, you get that much, but be careful! If you lose, <b>all</b> of that money disappears!</p>
						<br><br><br>
		        		<p>Note, the questions may vary each time you play, so you can have many rounds of fun!</p>
		      		</div>
		      		<div class="modal-footer">
		        		<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
		      		</div>
		    	</div>
		  	</div>
		</div>


		<div id="alert" class="container"></div>

		<div align="center">
			<br>
			<div class="container" id="chooseQuestionPage">
				<div class="row">
					<div class="col-md-6">
						<div class="well" id="category0">
							<script>
								document.getElementById("category0").innerHTML = "<h4>" + getCategoryTitle(0) + "</h4>";
							</script>
						</div>
					</div>
					<div class="col-md-6">
						<div class="well" id="category1">
							<script>
								document.getElementById("category1").innerHTML = "<h4>" + getCategoryTitle(1) + "</h4>";
							</script>
						</div>
					</div>
				</div>
				<br>
				<div class="row">
					<div class="col-md-3">
			  			<div class="alert alert-info" id="0.100">
							<a href="#" onclick="showQuestionPage(0, 100)">100</a>
						</div>
					</div>
					<div class="col-md-3">	
			  			<div class="alert alert-info" id="0.200">
							<a href="#" onclick="showQuestionPage(0, 200)">200</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info" id="1.100">
							<a href="#" onclick="showQuestionPage(1, 100)">100</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info" id="1.200">
							<a href="#" onclick="showQuestionPage(1, 200)">200</a>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(0, 300)">300</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(0, 400)">400</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(1, 300)">300</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(1, 400)">400</a>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(0, 500)">500</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(0, 600)">600</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(1, 500)">500</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(1, 600)">600</a>
						</div>
					</div>
				</div>
				<br><br><br><br>
				<div class="row">
					<div class="col-md-6">
						<div class="well" id="category2">
							<script>
								document.getElementById("category2").innerHTML = "<h4>" + getCategoryTitle(2) + "</h4>";
							</script>
						</div>
					</div>
					<div class="col-md-6">
						<div class="well" id="category3">
							<script>
								document.getElementById("category3").innerHTML = "<h4>" + getCategoryTitle(3) + "</h4>";
							</script>
						</div>
					</div>
				</div>
				<br>
				<div class="row">
					<div class="col-md-3">
			  			<div class="alert alert-info" id="2.100">
							<a href="#" onclick="showQuestionPage(2, 100)">100</a>
						</div>
					</div>
					<div class="col-md-3">	
			  			<div class="alert alert-info" id="2.200">
							<a href="#" onclick="showQuestionPage(2, 200)">200</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info" id="3.100">
							<a href="#" onclick="showQuestionPage(3, 100)">100</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info" id="3.200">
							<a href="#" onclick="showQuestionPage(3, 200)">200</a>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(2, 300)">300</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(2, 400)">400</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(3, 300)">300</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(3, 400)">400</a>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(2, 500)">500</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(2, 600)">600</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(3, 500)">500</a>
						</div>
					</div>
					<div class="col-md-3">
			  			<div class="alert alert-info">
							<a href="#" onclick="showQuestionPage(3, 600)">600</a>
						</div>
					</div>
				</div>
				<br><br><br><br>
				<div class="container row">
					<div class="col-md-3"></div>
					<div class="well col-md-6" style="align:center"><a href="#" onclick="showFinalQuestionPage()"><h4>Move to last question</h4></a></div>
				</div>
			</div>
			<div class="container" id="questionPage" style="display:none"> <!--WONT BE SHOWN AT FIRST, USE THE MULTIPLE PAGES THING--> 
				<div class="row">
					<div class="col-md-1"></div>
					<div class="col-md-10 well" id="question"></div>
				</div>
				<div class="row">
					<div class="col-md-3"></div>
					<div class="col-md-6 alert alert-info" id="answer0"></div>
				</div>
				<div class="row">
					<div class="col-md-3"></div>
					<div class="col-md-6 alert alert-info" id="answer1"></div>
				</div>
				<div class="row">
					<div class="col-md-3"></div>
					<div class="col-md-6 alert alert-info" id="answer2"></div>
				</div>
				<div class="row">
					<div class="col-md-3"></div>
					<div class="col-md-6 alert alert-info" id="answer3"></div>
				</div>
				<div class="row" id="return"></div>
			</div>
		</div>
		<div id="finalResult"></div>
	<body>
</html>